NDSS	  2012,	  February	  7th	  2012,	  San	  Diego	  

Hey,	  You,	  Get	  Oﬀ	  of	  My	  Market:	  

Detec5ng	  Malicious	  Apps	  in	  	  

Oﬃcial	  and	  Alterna5ve	  Android	  Markets	  

Yajin	  Zhou	  	  	  	  Zhi	  Wang	  	  	  	  Wu	  Zhou	  	  	  	  Xuxian	  Jiang	  

North	  Carolina	  State	  University	  

MoDvaDon:	  Smartphones	  

s	  
n
o

i
l
l
i

M

100	  

80	  

60	  

40	  

20	  

0	  

202%	  

442%	  

44.7	  

8.7	  

10.6	  

25.4	  

90.2	  

19.6	  

46.8	  

23.8	  

iOS	  
Android	  
Symbian	  

Q2	  2010	  

Q2	  2011	  

Worldwide	  Smartphone	  Sales	  1	  

1Data	  source:	  gartner.com	  	  

2	  

MoDvaDon:	  Apps	  

	  
s
d
n
a
s
u
o
h
T

600	  	  

500	  	  

400	  	  

300	  	  

200	  	  

100	  	  

0	  	  

525	  	  

400	  	  

298	  	  

202	  	  

130	  	  

76	  	  

6	  	  

16	  	  

36	  	  

Q3	  2009	   Q4	  2009	   Q1	  2010	   Q2	  2010	   Q3	  2010	   Q4	  2010	   Q1	  2011	   Q2	  2011	   Q3	  2011	  

Number	  of	  Apps	  in	  Oﬃcial	  Android	  Market2(cid:1)

2Data	  source:	  androlib.com	  

3	  

MoDvaDon:	  Markets	  

4	  

MoDvaDon:	  Malware	  in	  Markets	  

What	  is	  the	  overall	  health	  	  

of	  Android	  Markets?	  

5	  

Design	  Goals	  

• Accuracy	  

•  Detect	  malware	  with	  low	  false	  posiDves	  and	  negaDves	  

• Scalability	  

•  Scale	  to	  hundreds	  of	  thousands	  apps	  

• Eﬃciency	  

•  Process	  all	  apps	  in	  a	  reasonable	  amount	  of	  Dme	  

6	  

DroidRanger	  Overview	  

R
e
p
r
e
s
e
n
t
a
D
v
e
A
n
d
r
o
d
M
a
r
k
e
t
s(cid:1)

i

	  

	  

App	  

Repository(cid:1)

Malware	  Samples(cid:1)

Permission-­‐based	  
Behavioral	  Footprints(cid:1)

Footprint-­‐based	  
DetecDon	  Engine	  

InfecDon	  from	  	  
Known	  Malware(cid:1)

HeurisDcs-­‐based	  
DetecDon	  Engine	  

InfecDon	  from	  	  

Zero-­‐day	  Malware(cid:1)

HeurisDcs(cid:1)

DroidRanger(cid:1)

7	  

Footprint-­‐based	  DetecDon	  Engine	  

• Filter	  apps	  with	  essenDal	  permissions	  

Malware	  

Geinimi	  

ADRD	  

Pjapps	  

Bgserv	  

EssenDal	  Permissions	  

INTERNET,	  SEND_SMS	  

INTERNET,	  ACCESS_NETWORK_STATE	  
RECEIVE_BOOT_COMPLETED	  

INTERNET,	  RECEIVE_SMS	  

INTERNET,	  RECEIVE_SMS,	  SEND_SMS	  

DroidDream	  

CHANGE_WIFI_STATE	  

zHash	  

CHANGE_WIFI_STATE	  

jSMSHider	  

INSTALL_PACKAGES	  

Zsone	  

RECEIVE_SMS,	  SEND_SMS	  

DroidDreamLight	  

INTERNET,	  READ_PHONE_STATE	  

BaseBridge	  

NATIVE	  CODE	  

Apps	  

7,	  620	  (4.17%)	  

10,	  379	  (5.68%)	  

4,	  637	  (2.54%)	  

2,	  880	  (1.58%)	  

4,	  096	  (2.24%)	  

4,	  096	  (2.24%)	  
Reduced	  to	  0.64%	  when	  
1,	  210	  (0.66%)	  

considering	  a	  broadcast	  receiver	  	  	  

3,	  204	  (1.75%)	  

71,	  095	  (38.89%)	  

8,	  272	  (4.52%)	  

8	  

Footprint-­‐based	  DetecDon	  Engine	  

• Match	  apps	  to	  malware	  behavioral	  footprints	  in	  
mulDple	  dimensions	  
•  InformaDon	  in	  manifest	  ﬁle	  

 Declare	  a	  receiver	  listening	  to	  SMS_RECEIVED	  

•  SemanDcs	  in	  the	  byte-­‐code	  

 Register	  a	  receiver	  listening	  to	  SMS_RECEIVED	  
 Call	  abortBroadcast	  in	  the	  receiver	  
 Send	  SMS	  messages	  to	  premium	  numbers	  

•  Structural	  layout	  of	  the	  app	  

Behavioral	  	  
footprint	  	  
of	  Zsone	  

9	  

HeurisDcs-­‐based	  DetecDon	  Engine	  

• Select	  apps	  with	  dynamic	  Java/naDve	  code	  loading	  
• Monitor	  their	  runDme	  behavior	  

•  Java	  code:	  permission-­‐related	  framework	  APIs	  
•  NaDve	  code:	  system	  calls	  requiring	  root	  privileges	  

10	  

EvaluaDon:	  Overall	  

• Data	  set	  

•  Crawled	  the	  oﬃcial	  &	  four	  alternaDve	  markets	  
•  Collected	  204,040	  free	  apps	  during	  05/2011-­‐06/2011	  

• Process	  Dme	  

•  Used	  four	  and	  half	  hours	  for	  all	  204,040	  apps	  

Oﬃcial	  
Market,	  
153,002	  

eoeMarket,	  

17,229	  

alcatelclub,	  

14,943	  

gfan,	  10,385	  

mmoovv,	  

8,481	  

11	  

EvaluaDon:	  Overall(cid:1)

Malware	  

Oﬃcial	  Market	  

eoeMarket	  	  

alcatelclub	  (cid:1)

gfan	  (cid:1)

mmoovv(cid:1)

Total	  

Known	  

Zero-­‐day	  

Total	  

21	  

11	  

32	  

51	  

9	  

60	  

48(cid:1)

10(cid:1)

58(cid:1)

20(cid:1)

1(cid:1)

21	  

31(cid:1)

9(cid:1)

40(cid:1)

(0.02%)	  

(0.35%)	  

(0.39%)(cid:1)

(0.20%)(cid:1)

(0.47%)(cid:1)

171(cid:1)

40(cid:1)

211(cid:1)

Total	  infected	  apps	  detected	  by	  DroidRanger	  

12	  

EvaluaDon:	  Footprint-­‐based	  DetecDon	  Engine	  	  

App	  

Repository(cid:1)

Malware	  Samples(cid:1)

Permission-­‐based	  
Behavioral	  Footprints(cid:1)

Footprint-­‐based	  
DetecDon	  Engine	  

InfecDon	  from	  	  
Known	  Malware(cid:1)

HeurisDcs-­‐based	  
DetecDon	  Engine	  

InfecDon	  from	  	  

Zero-­‐day	  Malware(cid:1)

HeurisDcs(cid:1)

DroidRanger(cid:1)

13	  

EvaluaDon:	  Infected	  Apps	  

0	  

5	  

10	  

15	  

20	  

25	  

30	  

ﬁrst	  report:	  10/2010	  

Geinimi	  

ADRD	  

Pjapps	  

Bgserv	  

DroidDream	  

zHash	  

BaseBridge	  

DroidDreamLight	  

Zsone	  

jSMSHider	  

Oﬃcial	  Market	  
eoeMarket	  
alcatelclub	  
gfan	  
mmoovv	  

14	  

EvaluaDon:	  Accuracy	  

Pjapps	  

BaseBridge	  

jSMSHider	  

Bgserv	  

ADRD	  

1	  

1	  

0	  
0	  

4	  
4	  

9	  
9	  

6	  

8	  

3	  
3	  

15	  

31	  
31	  

DroidRanger	  
LookOut	  Ver	  6.11	  (11/2011)	  
LookOut	  Ver	  6.3	  (08/2011)	  

15	  

EvaluaDon:	  Accuracy	  

• 24	  samples	  in	  10	  known	  families	  from	  contagio(cid:1)
• DroidRanger	  detected	  23	  samples	  (96%)(cid:1)

•  Missed	  a	  payload	  of	  DroidDream,	  not	  the	  malware	  itself	  
•  Found	  one	  mis-­‐categorized	  sample	  for	  ADRD	  

16	  

EvaluaDon:	  HeurisDcs-­‐based	  DetecDon	  Engine	  	  

App	  

Repository(cid:1)

Malware	  Samples(cid:1)

Permission-­‐based	  
Behavioral	  Footprints(cid:1)

Footprint-­‐based	  
DetecDon	  Engine	  

InfecDon	  from	  	  
Known	  Malware(cid:1)

HeurisDcs-­‐based	  
DetecDon	  Engine	  

InfecDon	  from	  	  

Zero-­‐day	  Malware(cid:1)

HeurisDcs(cid:1)

DroidRanger(cid:1)

17	  

EvaluaDon:	  Infected	  Apps	  

• Detected	  two	  zero-­‐day	  malware	  using	  heurisDcs	  

•  Plankton:	  dynamic	  loading	  of	  Java	  code	  
•  DroidKungFu:	  dynamic	  loading	  of	  naDve	  code	  

• Detected	  40	  samples	  using	  behavioral	  footprints	  

•  11	  samples	  from	  the	  oﬃcial	  Android	  Market	  
•  29	  samples	  from	  alternaDve	  Android	  Markets	  	  

18	  

EvaluaDon:	  Malware	  Behaviors	  

• Plankton	  

•  Uploads	  a	  list	  of	  permissions	  before	  downloading	  a	  payload	  
•  Contains	  a	  bot-­‐like	  command	  &	  control	  channel	  

• DroidKungFu	  

•  Contains	  two	  encrypted	  root	  exploits	  
•  Installs	  a	  payload	  app	  mimicking	  Google	  Search(cid:1)

19	  

Discussion	  

• Need	  more	  comprehensive	  heurisDcs	  

•  Background	  sending	  of	  unauthorized	  SMS	  messages?	  
•  Bot-­‐like	  behavior	  controlled	  by	  SMS	  messages?	  

• A	  call	  for	  rigorous	  venng	  processes	  

•  A	  large	  number	  of	  users	  can	  be	  infected	  
•  Malware	  remains	  in	  alternaDve	  markets	  for	  a	  long	  Dme	  
•  Zero-­‐day	  malware	  exists	  in	  Android	  Markets	  

20	  

Related	  Work	  

• Smartphone	  plaoorm	  security	  	  

•  TaintDroid	  (Enck	  et	  al.,	  OSDI	  10),	  PiOS	  (Egele	  et	  al.,	  NDSS	  11),	  Stowaway	  	  (Felt	  et	  al.,	  CCS	  11),	  

Cells	  (Andrus	  et	  al.,	  SOSP	  11),	  AppFence	  (Hornyack	  	  et	  al.,	  CCS	  11),	  Quire	  (Dietz	  	  et	  al.,	  
USENIX	  Security	  11),	  A	  Study	  of	  Android	  ApplicaDon	  Security	  (Enck	  et	  al.,	  USENIX	  Security	  
11),	  TISSA	  (Zhou	  et	  al.,	  TRUST	  11),	  Woodpecker	  (Grace	  et	  al.,	  NDSS	  12)	  …	  

• Malware	  detecDon	  on	  mobile	  devices	  

•  pBMDS	  (Xie	  et	  al.,	  WiSec	  10),	  VirusMeter	  (Liu	  et	  al.,	  RAID	  09),	  Crowdroid	  (Burguera	  et	  al.,	  

CCS-­‐SPSM	  11)	  …	  

• Other	  systemaDc	  security	  study	  

•  HoneyMonkey	  (Wang	  et	  al.,	  NDSS	  06),	  SystemaDc	  Web	  Spyware	  Study	  (Moshchuk	  et	  al.,	  

NDSS	  06),	  All	  Your	  iFRAMEs	  Point	  to	  Us	  (Provos	  et	  al.,	  USENIX	  Security	  08)	  …	  

21	  

Conclusion	  

• DroidRanger	  is	  a	  system	  to	  systemaDcally	  study	  the	  
overall	  health	  of	  exisDng	  Android	  Markets	  	  

Malware	  

Oﬃcial	  Market	  

eoeMarket	  	  

alcatelclub	  (cid:1)

gfan	  (cid:1)

mmoovv(cid:1)

Total	  

Known	  

Zero-­‐day	  

Total	  

21	  

11	  

32	  

51	  

9	  

60	  

48(cid:1)

10(cid:1)

58(cid:1)

20(cid:1)

1(cid:1)

21	  

31(cid:1)

9(cid:1)

40(cid:1)

(0.02%)	  

(0.35%)	  

(0.39%)(cid:1)

(0.20%)(cid:1)

(0.47%)(cid:1)

171(cid:1)

40(cid:1)

211(cid:1)

22	  

Thank	  You!	  

23	  

EvaluaDon:	  Known	  Malware	  Samples	  

• 20	  samples	  from	  10	  malware	  families	  

Malware	  
Geinimi	  

ADRD	  

Pjapps	  

Bgserv	  

First	  Report	  	  

Summary	  

10/2010	  

Trojan	  with	  bot-­‐like	  capability	  

02/2011	  

Trojan	  with	  bot-­‐like	  capability	  

02/2011	  

Trojan	  with	  bot-­‐like	  capability	  

03/2011	  

Trojan	  with	  bot-­‐like	  capability	  

DroidDream	  

03/2011	  

Root	  exploit	  with	  Exploid,	  Rageagainsrhecage	  

zHash	  

03/2011	  

Root	  exploit	  with	  Exploid	  

BaseBridge	  

05/2011	  

Root	  exploit	  with	  Rageagainsrhecage	  

DroidDreamLight	  

05/2011	  

Trojan	  with	  informaDon	  stealing	  capability	  

Zsone	  

05/2011	  

Trojan	  that	  sends	  premium-­‐rate	  SMS	  

jSMSHider	  

06/2011	  

Trojan	  that	  target	  third-­‐party	  ﬁrmware	  

24	  

