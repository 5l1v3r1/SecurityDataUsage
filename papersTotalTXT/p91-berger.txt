InternetNameserverIPv4andIPv6AddressRelationshipsArthurBergerMITCSAIL/Akamaiawberger@csail.mit.eduNicholasWeaverICSI/UCSDnweaver@icsi.berkeley.eduRobertBeverlyNavalPostgraduateSchoolrbeverly@nps.eduLarryCampbellAkamailcampbel@akamai.comABSTRACTThemodernDomainNameSystem(DNS)providesnotonlyresolution,butalsoenablesintelligentclientrouting,e.g.forContentDistributionNetworks(CDNs).TheadoptionofIPv6presentsCDNstheopportunitytoutilizediﬀerentpathswhenoptimizingtraﬃc,andthechallengeofappro-priatelymappingIPv6DNSqueries.Thisworkseekstodis-covertheassociationsbetweenInternetDNSclientresolverIPv6address(es)andIPv4address(es).Wedesignandim-plementtwonewtechniques,onepassiveandoneactive,togatherresolverpairings.Thepassivetechnique,deployedinAkamai’sproductionDNSinfrastructure,opportunisticallydiscovered674k(IPv4,IPv6)associatedaddresspairswithinasix-monthperiod.Weﬁndthat34%ofaddressesareone-to-one,i.e.appearinnootherpair,afractionthatincreasesto≈50%whenaggregatingIPv6addressesinto/64pre-ﬁxes.Theone-to-oneassociationsaresuggestive,butnotasuﬃcientcondition,ofdual-stackDNSrecursiveresolvers.WefurthersubstantiateourinferencesviaPTRrecordsandsoftwareversions,andmanualveriﬁcationofsamplepairingsbythreemajorNetworkOperators.Complexassociations,wheree.g.distributedDNSresolutionleadstoinferredad-dressgroupingsthatspancontinentsandmanyautonomoussystemsexist,asubsetofwhichweexploreinmoredepthusingtheactiveprobingtechnique.Amongpotentialuses,Akamaiiscurrentlyutilizingscreenedoutputfromthepas-sivetechnique,inconjunctionwithpriorknowledgeofIPv4,toinformIPv6geolocationwithinitsCDN.CategoriesandSubjectDescriptorsC.2.3[ComputerCommunicationNetworks]:NetworkOperations—networkmonitoringGeneralTermsMeasurement,Experimentation(c)2013AssociationforComputingMachinery.ACMacknowledgesthatthiscontributionwasauthoredorco-authoredbyanemployee,contractororafﬁliateoftheUnitedStatesgovernment.Assuch,theUnitedStatesGov-ernmentretainsanonexclusive,royalty-freerighttopublishorreproducethisarticle,ortoallowotherstodoso,forGovernmentpurposesonly.IMC’13,October23–25,2013,Barcelona,Spain.Copyright2013ACM978-1-4503-1953-9/13/10...$15.00.http://dx.doi.org/10.1145/2504730.2504745.KeywordsDNS;Nameservers;Resolvers;IPv61.INTRODUCTIONAfterlanguishingfordecades,IPv6[13]isexperiencingrenewedinterest[17],inlargepartduetoeconomicsandpolitics[10,23].However,IPv4andIPv6areexpectedtoco-existfortheforeseeablefuture.Transitionstrategies,prac-ticalconstraints,andinertiaimplythatportionsoftheIPv6infrastructurewilldependonIPv4,wherehostsandinfras-tructureare“dual-stacked.”PreviousmeasurementresearchhasexploredIPv6pene-trationofthebroaderclientpopulation,forinstanceviawebinstrumentation[11,32,27].Severalinitiatives[18,19]andanecdotalevidence[28]suggestthatIPv6infrastructurede-ploymentisproceedinginadvanceofclientadoption.Forinstance,manylargeresidentialnetworks[12]andcontentproviders[1]fullysupportIPv6.Animportantcomponentofanyprovider’stransitionplansisenablingIPv6ontheirDomainNameSystem(DNS)servers,includinglocalrecur-siveclientresolvers.OurmotivationisinterestinassociatingInternetDNSresolverIPv6address(es)withIPv4address(es).Opera-tionally,suchassociationisespeciallyimportanttoCon-tentDistributionNetworks(CDNs),whereinformationofaclient’srecursiveresolverisusedtoperformintelligentclientroutingandloadbalancing.Weareparticularlyinterestedthesimplecaseofone-to-oneassociationsassuchpairsarecandidatesforbeingonthesamemachine,oreveninterface,andthuscollocated,whichcanbeusedasaninputtoIPv6geolocation.Ourworkisconcernedwithdevelopingtechniquesforas-sociatingIPv4andIPv6DNSresolveraddresses,andper-forminglarge-scalemeasurementstocollectsuchassocia-tions.Whileoutofscopeforthepresentpaper,obtainingDNSresolverassociationsbetweenthetwoprotocolshassev-eralpotentialfutureapplications:1.InternetEvolution:AsIPv6deploymentcontinues,theinfrastructuresupportingeachprotocolwillevolve.Thetechniqueshereincanbeusedinthefutureforalongitudinalstudyoftrackingtheinter-relationshipofIPv4andIPv6nameservers.2.IPv6Geolocation:ThereispotentialtoleveragepriorknowledgeofgeolocationofIPv4addresses[5]toinformIPv6geolocationwhentheaddressesarecorre-lated.One-to-oneDNSresolverassociationsarecon-91sistentwith,butnotproofof,thecorrespondingIPv4andIPv6addressesbeingassignedtothesamema-chine,andthusbeingatthesamephysicallocation.Furtherscreeningofsuchpairs,discussedin§5.1,canpickoutthosethataremorelikelytobecollocated.However,aswithotherinputstogeolocation,ourasso-ciationsarelikelytobenoisyandthusmustbeappro-priatelyweighted.AkamaiTechnologiesiscurrentlyusingscreenedoutputfromtheopportunisticpassivetechnique,§2.1,inconjunctionwithpriorknowledgeofIPv4,asoneoftheinputsforIPv6geolocationwithinitsCDN.3.Security:IPv4,IPv6nameserverpairsthatarelikelyonthesamemachineareofinterestfromasecurityviewpoint.NotonlyaremanyoldIPv4attacksfea-sibleinIPv6[7],IPv6introducesnewattackvectors[16].AnattackdirectedagainsttheIPv6addressofaDNSservermayalsoimpactanorganization’scorre-spondingIPv4service.Ourhopeisthatourtechniquesanddatafromthisre-searchcanbeusedasaﬁrststeptowardfutureworkontheseimportantapplications.Tothisend,wedeveloptwonoveltechniquesfordiscov-eringassociatedIPv4andIPv6resolveraddresses:i)apas-sive,opportunistictechniquethatusesatwo-levelDNShier-archythatencodesIPv4addresseswithinIPv6nameserverrecords;andii)anactivetechniquewherebyweprobere-solverstoinducevariouslookupbehaviors.Ourtechniquesprovidenewmethodstocharacterizeasmall,butcritical,portionoftheInternetinfrastructure.ThepassivetechniquehasbeenimplementedintheAka-maiCDN,andfor674k(IPv4,IPv6)addresspairsobservedoverasixmonthperiod,weﬁndthat34%ofthecollectedresolveraddresseshaveaone-to-oneassociation,i.e.appearinnootheraddresspair.Thispercentageincreasestoal-most50%whentheIPv6’sareaggregatedto/64preﬁxes,(creatingpairsofanIPv4addresswithanIPv6/64pre-ﬁx).Wealsodiscovercomplex,connectedsetsofaddresspairsthat,attheextreme,spancontinentsandhundredsofAutonomousSystems,wherelargeclusterresolversandpublicDNSprovidersplayamajorrole.Additionally,weﬁndevidenceofabnormaluseof6to4tunnels.Tohelpsubstantiateourresults,weanalyzethePTRrecordsandsoftwareversionsoftheassociationinferences.Formoreprecisevalidationofasubsetoftheassociations,weemployouractivemeasurementtechniquetoperformadatacollectionover13hourstominimizetemporaladdressassignmentchangesandcorroboratetheextantcomplexitydiscoveredpassively.Last,forsamplessenttopersonalcon-tactsatsixmajornetworks,threerespondedandmanuallyconﬁrmedthatallofourinferredone-to-oneassociationsthattheycheckedwerecorrectandindeedassignedtothesamemachine.Intotal,thispapermakesfourprimarycontributions:1.AnewpassivetechniqueforopportunisticallypairingIPv4andIPv6addressesofDNSresolvers.2.Anovelapproachforactive,targeted,DNSresolverprobingtodiscoverassociatedaddresspairs.3.Real-worlddeploymentofthepassivetechniqueonacommercialCDNtogatheralargecrosssectionofIn-ternetresolvers.src: IPv6, dst: 2001:428::IPv4PairsDNS ResolverIPv4IPv6NS=2001:428::IPv4A? www.a.example.com(IPv4,IPv6)A? www.a.example.comSecond(cid:239)LevelFirst(cid:239)LevelAuth DNSAuth DNSFigure1:DNSResolverIPv4/IPv6AddressInfer-ence:Amulti-levelauthorityreturnssecond-levelnameserverAAAArecordsencodingaquery’sIPv4sourceinthelower-orderbits.Thesecond-levelnameserverassociatesIPv6sourceswiththeIPv4encodedinthedestinationIPv6.4.AnalysisofobservedDNSresolveraddresspairsthatﬁndsasigniﬁcantproportion,34%,haveaone-to-oneassociation(almost50%whentheIPv6’sareaggre-gatedto/64preﬁxes)andalsoﬁndscomplex,con-nectedsetsofaddresspairs.Theremainderofthispaperisorganizedasfollows.Sec-tion2detailsthetwomeasurementtechniquescomprisingoursystemaswellasourdeployment.Wesummarizethecollecteddatain§3,presentitsanalysisin§4,anddiscussﬁndingsin§5.Finally,weconcludein§6withasummaryofimplicationsandsuggestionsforfuturework.2.METHODOLOGYOursystemincludestwonovelmeasurementtechniques.First,wedevelopapassive,opportunisticmethodtodis-covercandidateIPv4andIPv6addressesofDNSresolvers.Second,wecreateacustomDNSserverthatpermitsactivemeasurementofDNSresolvers.Inthissection,wedetailthesetechniques.2.1OpportunisticDNSTechniqueClientsrelyonlocalrecursiveresolverstoperformDNSresolution.WeseektoascertaintheIPv4,IPv6addressesofdual-stackedDNSresolversbyinducingthemtorevealtheiraddressesaspartoftheirnaturallookupprocess.Ourtechniqueexploits:1)atwo-levelauthoritativeDNSresolution,and2)theabilitytoencodeanIPv4addressinthelowerorderbitsofanIPv6address.Forthepurposeofexposition,assumewecontrol,anddeployourtechniqueon,theDNSauthorityofexample.com.ConsiderarecursiveDNSresolverservicingalocalclientrequestingresolutionofwww.a.example.com.AsdepictedinFigure1,theresolverrequestsresolution(typicallyanArecord)forthishostfromtheﬁrst-levelauthoritativename-serverviaanIPv4DNSquery.Theﬁrst-levelnameserverrespondswiththesecond-levelNS,andcorresponding“addi-tional”AandAAAA,records[22].Crucially,theAAAArecordsofthesecond-levelNS,asreturnedbyourﬁrst-levelname-server,areformeddynamically.Theﬁrst-levelDNSencodesaquery’sIPv4sourceaddressinthelower-orderbitsoftheresponse’sadditionalAAAArecord.Forexample,Figure1showstheﬁrst-levelDNSrespond-ingtoaDNSresolver’squerywiththeauthoritativeNSrecordofthesecond-levelDNS,includinganadditionalAAAArecordforthesecond-levelnameserverthatincludesthequery-ingresolver’sIPv4sourceaddressinthelow-orderbits.The92recursiveDNSresolvermayuseeithertheAorAAAAaddressforthesecond-levelresolution.Whenthelatterisused,thesecond-levelDNScanpairtheIPv6sourceaddressofthequeryitreceiveswiththeIPv4addressencodedintheIPv6destinationofthequery.Notethatthedynamicallygener-atedAAAAnameserverrecordisvalidasthesecond-levelDNSacceptsqueriesfromanentirepreﬁx;weusea/80preﬁx.AkamaiTechnologieshasdeployedthispassivetechniquewithinitsproductioninfrastructure[26],makinguseofitspre-existingmulti-levelDNShierarchy(whoseprimarypur-poseistoresolvenamestoCDNaddressesthatcanbestservetheclient),andhasactivateditforaselectionofdo-mains.Akamaihasusedtheresultingdatacollectionduringtherevisionofitsrequest-routingsoftwaretosupportIPv6,andcontinuestouseitasoneoftheinputsintoAkamai’sgeolocationproduct[5]wheretheextensivepriorknowledgeofIPv4canbeusedtoaidinthelocationofIPv6whentheIPv4andIPv6addressesareinferredtobecorrelated.Asapracticalissue,theﬁrst-levelauthoritativeDNSinFigure1doesnotknowwhethertheclient’snameserverisIPv6capable,astheincomingDNSqueryarrivesoverIPv4.Thus,inAkamai’simplementation,ofeightNSrecordsreturned,onlyoneortwooftheassociatedgluerecordsareAAAA.Also,evenwhentheclient’snameserverisdualstacked,itmaynotselecttheAAAA;selectionordertypicallydependsonhistoricalloadandperformancecharacteristics.Notethatthistechniqueisopportunistic:aclientresolvermustﬁrstcontactourauthoritativeDNSforresolutionofanobjectwithinourportionoftheDNSnamespace.Noadditionalpacketsaresentwhenonedeploysthetechniquefordomainnamesthatarebeingusedanyway.Becausethetechniqueispassive,wherethecollectionofaddresspairsissimplyaby-productoftheclient’sresolverrequestingadomainunderourauthority,therearenorestrictionsonthepopulationofresolverswecanmeasure.Inparticular,wearenotlimitedtoopenresolversastheentitycollectingthedataisnotinitiatingtheDNSquery.Alsonotethatthepassivetechniqueonlycheckswhethertheclient’sresolvercansendIPv6,butdoesnotcheckwhetheritcanreceiveIPv6.IfitcannotreceiveresponsesoverIPv6,thequerywilltimeout,andtheresolvercanfallbacktoretryusinganIPv4gluerecord.Insuchascenario,westillrecordan(IPv4,IPv6)pair.Thisambiguitydoesnotoccurwiththeactivetechniqueof§2.2.Thepassivetechniquecanbeimplementedonanyau-thoritativenameserversundercommoncontrolalongaDNSnamespacehierarchy.Itcanbeimplementedevenonasin-glemachine,withmultipleaddresses,wheretheIPv4glueaddressfortheNSrecordforexample.comisdistinctfromtheIPv4andIPv6glueaddressesfortheNSrecordthatcausesthelookuptothesecondlevel.However,ourdeploy-mentusingseparateﬁrstandsecond-levelauthoritiesismostcompatiblewiththeexistingAkamaiinfrastructure,wheredeploymentonAkamaiaﬀordsusarichanddiversedataset.2.1.1AdvantageousComplicationsFigure1illustratesthesimplecasewheretheDNSqueriescomefromasingle,dual-stackedmachine.However,therealityofInternetDNSresolutioncanbemuchmorecom-plex.Recallthatthe(IPv4,IPv6)addressesthatareloggedareaddressesseenbytheauthoritativenameservers.Theyneednotbeassociatedwiththesamemachine.Itiswell-knownthatDNSserversandresolversexperiencesigniﬁcantload,andthatmanyapproachesexistforbalancingDNSqueryload[25,3,15,4].Arelativelycommoncase,espe-ciallyamonglargeproviders,isthataprovidermaintainsasetofserversatalocationthatsharetheload,andalsomayshareacacheormaydistributeobtainedresolutions.Further,DNSresolverimplementationsmayperformrecordpre-fetching[4]inaneﬀorttoimproveperformance.InAkamai’simplementation,theNSrecordsreturnedbytheﬁrst-levelauthoritativeDNShaveaTTLof12hours.Thus,ifthereissharedcacheoriftheresultsaredistributed,thenanothernameservermaysubsequentlyusecachedre-sultsandsendaqueryoverIPv6,inwhichcasethesecond-levelnameserverwilldiscovermultipleIPv6addressesasso-ciatedwithasingleIPv4address.AshortTTLontheﬁnalAorAAAArecord(20secondsintheAkamaiimplementation)increasesreuseofthecachedNSrecord.Furthermore,aftertheNSTTLexpires,ifsomeothernameserverintheclusterdoesthelookupattheﬁrst-level,thenanotherIPv4addresscouldbeseenbytheauthoritativenameserver.InwhichcasethedatasetwillcontainmultiplepairswhichhaveIPv4orIPv6addressesincommon,allofwhichareassociatedwithagivenclusterofDNSserversatagivenlocation.Thiscomplexityisanadvantageouscomplicationfromanumberviewpoints.Forgeolocation,onehasdiscoveredadditionaladdressesthatarelikelycollocated.ForCDN’sthatwishtoassociateclientstonameservers,onemightgeneralizeanobservedsetof(clientaddress,nameserveraddress)pairstoanyoftheseclientspotentiallybeingassociatedwithanyofthesenameservers.Further,fromtheviewpointofsurviv-ability,orrobustness,onehasgainedsomeinsightintohowtheISPhaschosentoarchitectitsDNS.However,clustersofDNSserverscomplicatethediscov-eryofpairsof(IPv4,IPv6)addressesthatcanbeinferredtoexistonthesameinterfaceormachine.However,in[8],wedescribepreliminaryworkonanactiveﬁngerprintingtech-niquethatseekstodeterminewhetherornotcandidatead-dresspairsareindeedonthesamemachine.Anothercomplicationiswhensometimesthereisanin-termediarymachinebetweentheclient’snameserverandtheauthoritativeﬁrstandsecond-levelnameservers,asforex-amplewhenaNetworkOperatorhasdeployedaDNScachehierarchy.AnothercaseiswhenapublicDNS,e.g.[2],isusedfortheIPv6butnottheIPv4,orviceversa.Thepresenceofintermediarymachinesisanegativecomplica-tionfromtheviewpointofwishingtoassociateaddressestoacommonmachineorsetofmachinesatagivenlocation.Though,itisinterestingfromtheviewpointofdiscoveryofDNSarchitectureandhowtheDNSisbeingused,asdis-cussedin§4.1.3.Notethatwhenusingthediscovered(IPv4,IPv6)pairsforgeolocationoneneedstotakeintoaccountthatthedatasetwilllikelycontainmisleadinginformation,assomeofthepairswillhaveaddressesthatareindistinctlocations.However,noisyinferencesarenotanewproblem,butratherawell-knownattributeofmanyoftheinputsusedforge-olocation;andonemustsort,weigh,andﬁlterconﬂictinginformationfrommultiplesources.2.1.2ExampleNameserverPairsToillustratethepotentialcomplexityoftheassociationswegatherpassively,wepresentseveralexampleresolverpairsinthissubsection.Often(tobequantiﬁedin§4.1.1)agivenIPv4addressandagivenIPv6appearinonlyonepair.93Forexample,thetwoaddressesinthepair:(119.63.216.69,2402:7400:0:c::5)areonlyobservedinthispair.However,justascommonaremorecomplexrelationships.ForexampletheIPv6address2001:380:515:1::201isobservedintwopairs:(210.227.79.198,2001:380:515:1::201)(210.227.79.230,2001:380:515:1::201)andthesetwoIPv4addressesareonlyseenforthisIPv6.Similarly,theIPv4address120.119.28.2isobservedinfourpairs:(120.119.28.2,2001:e10:c41:49:c5e5:281b:44f8:80bd)(120.119.28.2,2001:e10:c41:51:226:b0ff:fedc:f970)(120.119.28.2,2001:e10:c41:1::2)(120.119.28.2,2001:e10:c41:59:cabc:c8ff:fe92:e8d6)andthesefourIPv6addressesareonlyseeninthesepairs.Theassociationscanbecomemoreinvolved,forexamplethefollowingsixpairs:(193.137.16.65,2001:690:2280:1::65)(193.137.16.65,2001:690:2280:801::135)(193.137.16.75,2001:690:2280:801::135)(193.137.16.75,2001:690:2280:1::75)(193.137.16.145,2001:690:2280:801::135)(193.137.16.145,2001:690:2280:801::145)formaconnectedsetofassociations,inthatstartingatanyaddressandfollowingtheassociations,onewouldeventuallytoucheachoftheaddressesinthisset.Suchsetsofaddresspairscanbecomplex.Inthe6-monthdataset,Section3,thereisoneparticularlylargegroupcon-sistingofaboutathirdofthe674,000addresspairs,andspanninghundredsofautonomoussystems(ASes)andmul-tiplecontinents.Thislargegroupoccurs,atleastinpart,duetoopen,publicnameserverssuchasGoogleDNS,andisofinterestfromtheviewpointofhowDNSisbeingused,andisdiscussedinSection4.1.3.2.1.3BipartiteGraphandEquivalenceClassesWeabstracttheobservedresolverpairsasabipartitegraphbetweenasetofIPv4addressesandadisjointsetofIPv6addresses.EachoftheobservedaddresspairsisanedgeofthegraphconnectingavertexintheIPv4settoavertexintheIPv6set.Thegraphisnotfullyconnected,butratherconsistsofmanysubsetsofconnectededges.Wecallasetofconnectededges(andtheaddresspairstheyrepresent)an“equivalenceclass,”abbreviated“eq.class.”Figure2illustratesanexamplebipartitegraphconsistingofﬁveIPv4addresses,sevenIPv6addresses,andeightaddresspairs(edges).Letm-ndenoteanequivalenceclasscontain-ingmIPv4andnIPv6addresses.InFigure2theaddresspairspartitionintofourequivalenceclasses,twoofwhichare1-1,oneis2-1andoneis1-4.2.2ActiveDNSMeasurementsInadditiontotheopportunistic,passiveDNSdatacol-lection,wedevelopanactiveDNSmeasurementtobothvalidateandbetterunderstandourpassiveresults.Weusethisactivetechniquetoprobethesubsetofpas-sivelygatheredresolversthatrespondtoexternalrequests,e.g.thesubsetcontainingopenandforwardingresolvers[6].IPv6IPv4Figure2:EquivalenceClasses:Theassociations(edges)betweenIPv4andIPv6addressesformabipartitegraph.Theconnectedcomponentsformequivalenceclassesofvarioussizes.Inthishypothet-icalexample,thenodesineachequivalenceclassareshadeduniquely.Twoofthefourequivalenceclassesare1-1(oneIPv4,oneIPv6node),oneis2-1,andoneis1-4.Moregenerally,thistechniquecanbeusedonanyresolverthatwillrespondtoprobesfromone’svantagepoint,suchasthoseofone’sownnetwork,orthenumerousopenDNSforwardersonthepublicInternet.OneactivelyprobestheresolversissuingspeciallycraftedqueriesforDNSrecordsforwhichweareauthoritative.Inthisway,wecontrolboththeDNSprobesandtheauthorityoftheDNSrecordsbeingprobed,therebypermittingtestingofopenDNSrecursiveresolversinourdataset.Figure3depictsthehigh-levelactiveDNSprobingmethodology.OurauthoritativedomainsareservedbyacustomDNSserverthatisstandardscompliant[14].OurauthoritativeserverlistensonbothIPv4andIPv6,butreturnsdiﬀerentresultsdependingupontheincomingrequest.TheserverhandlesmultipledomainsthatsupporteitherIPv4orIPv6requests,wherethechoiceofdomainimpactstheIPprotocolusedbyarecursiveresolver.Weinitiatequeriestotheopenandforwardingresolvers.TheresultsfromourDNSserverforthequeriedobjectin-ducetheresolverundertesttoissueaseriesofqueriesthatalternatebetweenIPv4andIPv6fornetworktransport.Wemaintainstatebetweenrequestsbyspeciallyencodingthereturnedresultssuchthattheﬁnalresponsetotherecursivequeryisa“chain”ofIPv4andIPv6addressesusedbytheresolverundertest.Maoetal.[21]alsoencodeanInternetaddressinadomainname,thoughinthediﬀerentcontextofassociatingIPv4clientswiththeclient’srecursiveresolveraddress,andwhereawebbugisinsertedinvolunteerwebpages.Figure4providesanexampletimingdiagramoftheinteractionofourproberandanauthoritativeDNSserverwithanopenresolverwhoseaddresseswewishtoinfer.Inthisexample,theresolverhasIPv6addresses=A1,A3andIPv4addresses=A2,A4.TheproberqueriestheopenresolverorforwarderforasingleTXTrecord.TheresolvercanonlyfetchthisnameusingIPv6,butinsteadofreturningtherecord’svalue,ourserverreturnsacanonicalname(CNAME)alias.ThisCNAMEencodestheIPv6addresswhichcontactedourserver;forexampleanIPv6address2001:f8b0::91isencodedintotheCNAME:2001yf8b0yy91.v4.dnstest.icsi.berkeley.edu94Open ResolverUnder TestAuthoritative ServerIterative DNS queriesIPv4 and IPv6 addressesProberRecursive DNS queryCNAME encodingresolver’s IP address(es)Encoded list of resolver’sdnstest.icsi.berkeley.edudnstest.icsi.berkeley.eduFigure3:ActiveDNSProbing:WesendqueriesforDNSrecordswhoseauthorityisunderourcontrol(shadedblue),therebypermittingtestingofopenresolversinourdataset.Ourauthoritativeserverisspeciallydesignedto:1)forcetherecursiveresolvertoalternatebetweenIPv4andIPv6transport;and2)encodetheresolver’ssourceIPaddresses.TheresultofourDNSprobesisanencodedlistoftheresolver’sIPv4andIPv6addresses.v6Q? c1.N.v6.domainCNAME=c2.N.A1.v4.domainCNAME=c3.N.A1.A2.v6.domainCNAME=txt.N.A1.A2.A3.v4.domainv6Q? c3.N.A1.A2.v6.domainv4Q? txt.N.A1.A2.A3.v4.domainTXT="A1 A2 A3 A4"v4Q? c2.N.A1.v4.domain c1.N.v6.domainTXT="A1 A2 A3 A4"Resolver (w/ IPv6=A1,A3; IPv4=A2,A4)Proberdomain Auth DNSFigure4:ActiveDNSProbing:OurauthoritativeDNSserverreturnsaseriesofCNAMEresultswithalternatingIPv6andIPv4glue.Weprobearesolverundertestforourspecialdomain,includinganonceN.StateismaintainedonaddressestheresolverusesbyencodingtheIPsalongthechain.TheﬁnalresultisthesequenceofIPv4,IPv6addressesusedbytheresolver(hereA1,A2,A3,A4).ThisreturnedCNAMEexistswithintheIPv4-onlydomain.ThenextCNAMEredirectsbacktoIPv6,encodingbothIPs.AfterfollowinganotherCNAMEbacktotheIPv4domain,ourserverﬁnallyreturnsaTXTrecordreportingthesequenceoffourIPaddresseswhichcontactedourserver.NotethatwhileDNSauthorityserversmaytypicallyincludemulti-plerecordsinasinglereturnedresult,ourserveronlyre-turnsoneresultatatimeinordertoforcemultiplelookupsandinferthechain.OurCNAMEencodingscheme,combinedwithDNSmessagecompression[22],ensurethat,evenintheworstcaseASCIIIPv4andIPv6encodingexpansion,ourchainsoflength4arelessthan512bytes.As512BisthelimitforDNSoverUDP,weensurethatourchainsrelyonneithertruncationnorEDNS0[30].Notethatourmethodologyincludesseveraltechniquestoensureaccuracy.First,eachqueryincludesanoncethatpreventseﬀectsduetoDNScaching.Second,allstateismaintainedinthequeriesthemselves,therebyremovingthepotentialformiscorrelationofIPv4andIPv6addresses.Forexample,toinferasetofIPv4andIPv6addressesusedbytheGooglepublicDNSresolvers,wequery:dig+shortTXT@8.8.8.8\cname1e6464.n123.v6.dnstest.icsi.berkeley.eduwheretheGoogleDNSresolver,aftersteppingthroughtheCNAME’s,ﬁnallysendsaqueryfortheTXTrecord:txt.n123.2607yf8b0y4004yc00yy153.64x233x168x86.\2607yf8b0y4004yc00yy156.v4.dnstest.icsi.berkeley.edu.TheauthoritativeDNS,notesthethreeaddressescontainedintherequesteddomain,andnotesthesourceaddressoftheincomingquery.TheauthoritativeDNSthenreturnstheTXTrecordthatincludesthenonceandthesequenceofaddressesthatcontactedourservertoresolvetherequest;inthisexample:"n123"\"2607:f8b0:4004:c00::153""64.233.168.86"\"2607:f8b0:4004:c00::156""64.233.168.85"Aswewillshowin§4,manylarge-scaleresolversareac-tuallyclusters,notindividualsystems.AclustermightbebehindasinglepubliclyfacingIPaddresswithloaddis-tributedamongmultiplebackendmachines,ormighten-compassmultiplepubliclyvisibleIPaddresses.Thus,onecanrepeattheactiveDNSprobesmultipletimesinordertogainamorecompletepictureofclusterstructurewhenpresent.SincetheDNSspeciﬁcation[14]requiresthattherecursiveresolverprocesstheentireCNAMEchain,thesefourIPaddressesshouldrepresentthesame“system”responsibleforcompletingtheDNSresolution.1Therepliesthemselveshavea0secondTTLandtherequestcontainsacounter,thusaresolvershouldnevercachetheresult.1WeinitiallynoticedacomplicationwhereaNATforwardercouldsendaninitiallookuptoourserverbut,afterreceiv-ingourCNAMEreply,itqueriesinsteadaconﬁguredrecursiveresolverfortheCNAME,astheinitialIPv4addresswasonlyusedintheﬁrstofthetwoIPv4queriesanddidnototh-erwiseclusterwellwiththerestoftheresolutionchange.WespeculatethatmostsuchsystemsarenotIPv6capa-ble,sowechangedourquery’sorderfromV4/V6/V4/V6toV6/V4/V6/V4topreventaNATfrominitiatingthere-questdirectly,forcingittocontacttheconﬁguredrecursiveresolverﬁrsttocompletetheresolutionprocess.95Table1:DatasetsSetMethodCollectionPeriodNum.IPv4Num.IPv6Num.PairsNotes6-monthdatasetPassiveMar.17toSep.13,2012270,000282,000674,000FromAkamai’sproductiondeployment.Includesﬁrstandlasttimetheaddresspairwasrecorded.12-daydatasetPassiveApr.18to30,201247,00046,000119,000FromAkamai’sproductiondeployment.Includesthenumberoftimesanaddresspairwasrecorded.1-daydatasetActiveApr.19to20,20135,0008,00041,000200repeatedteststo7,000openresolversofthe6-monthdataset.AlthoughlimitedtoprobingIPv6-capableopenresolversandforwarders(thusexcludingmostcorporatenetworks),theactivemeasurementhasseveraladvantagesoverthepas-sivemeasurements.ThistechniqueforcestheresolvertouseIPv6(insteadofrelyingonaresolver’spreferenceforIPv6overIPv4).Sincethemeasurementsalloccurwithinashorttimewindow,thismeasurementisnotaﬀectedbynetworkchanges.Italsoproducesasetofuptofourassociations,al-lowingittomoreeﬀectivelyandpreciselymapthestructureofaclusterresolver.3.DATASETSWeexaminethreedatasets,summarizedinTable1.The6-monthdatasetisfromAkamai’sproductiondeployment.Theaddresspairsareobtainedbythepassive,opportunisticDNStechnique,describedin§2.1.Akamaiobservesasignif-icantcross-sectionofglobalDNStraﬃcinitsroleasalargeCDN;thedatasetincludesresolversfromover213countries[5]andcontains:674,000unique(IPv4,IPv6)pairswith271,000uniqueIPv4and282,000uniqueIPv6addresses.The12-daydatasetisalsofromAkamai’sdeploymentandthepassiveDNStechnique,thoughthelogswerecol-lectedandaggregatedviaascriptthatrecordsthenumberofobservationsofeachaddresspair.Ameasureofthepop-ularityofanaddresspairisusefulasanadditionalcriteriawhenscreeningforcollocatedaddresses,anditisbeingin-corporatedintoarevisedcollectionandaggregationoftheAkamailogs.The1-daydatasetisobtainedbytheactivetechniqueof§2.2.Wetesttheaddressesinthe6-monthdatasettode-terminewhethertheyreturnaresponsefromourprober,i.e.whethertheyareopen2,andwereceiveresponsesfrom5,308IPv4and1,677IPv6resolveraddresses.Whilethisisonlyasubsetofthefulldata,itpermitsvalidationagainstamean-ingfulpoolofsystems.Theseaddressesarethenrepeatedlyprobed,atleast200timesoverthenexthours.3WeusethisactivedatasettoinvestigatetheadditionalcomplexityintheDNSinfrastructurethatisrevealedbyrepeatedprobestoagivensetofresolvers.2Weagainemphasizethatwhileouractivetechniquere-quiresanopenresolver,thepassivetechniquedoesnot.3Thereturnedv6/v4/v6/v44-tupleoftencontainsaddressesdistinctfromtheaddressesprobed,thus,from≈7,000openresolversprobed,≈13,000addressesoccurinthe4-tuples,Table1.Thenumberofsystemsprobedissigniﬁcantlylowerthanthenumberofopen“recursiveresolvers”becausethisonlyincludedsystemssupportingIPv6andonlyincludedtrueopenresolvers,ratherthanthebulkofmisconﬁguredhomeNATsandotherDNSforwarders.4.RESULTSThissectionanalyzesresultsfromdeployingtheaforemen-tionedtechniquesontheIPv4andIPv6Internet.Weﬁrstexaminethesix-monthpassivedataset,focusingonthe1-1eq.classes,andtheabilitytolimittheprevalenceofcomplexassociationsviavariousformsofaggregation.Tobetterun-derstandtheremainingcomplexity,whichisasmallfractionoftheeq.classes,butalargenumberofaddresses,weexam-ineoneofthelargesteq.classes.Usingouractivetechnique,weexploitthesubsetofopenresolversinthesix-monthpas-sivedatasettoshowsimilarlycomplexeq.classes.Wethenconsidertheadditionalattributeofthefrequencythatanaddresspairisobserved.Last,weperformthreeformsofvalidationtoincreasetheconﬁdenceinourresults:prob-ingforconsistentsoftwareversionandPTRrecords,andmanualveriﬁcationbynetworkoperators.4.1PassiveTechniqueAddressDiscovery(Six-MonthDataSet)Weexaminetheaddresspairsofthe6-monthdataset.Recallthatwedeﬁnean“EquivalenceClass”tobeasetofconnectededges(addresspairs)inabipartitegraph(§2.1.3).Am-neq.classconsistsofmIPv4andnIPv6addresses,anda1-1eq.classisthesimplecaseofanaddresspairwhereneitheraddresshasbeenobservedinanyotherpair,andisconsistentwith(butnotaguaranteeof)thetwoaddressesbeingassignedtoacommonresolver.Figure5isascatterplotofalleq.classes,usingtheirrelativefrequencyasthecolorkey.Weobservethatthesmalleq.classes,1-1and1-2,arethemostcommon,andthatthereexistsabroadrangeofsizes,withlargereq.class-esoftenrepresentingasingularoccurrence.Wefocusﬁrstonthe1-1eq.classes,andthenexaminethelargerones.4.1.1Focuson1-1EquivalenceClassesThecanonicalcaseofasimpledual-stackserverwithasingleroutableIPv4andIPv6addresswouldbeobservedasa1-1eq.class,thoughtheconverseneednotholdasa1-1relationshipmayalsobethepublicfacingportionofamorecomplicatedarchitecture.Fromtheperspectiveofﬁndingcandidatedual-stackserversmore1-1eq.classesisbetter.AsshownintheﬁrstrowofTable2,34%oftheaddresses(IPv4plusIPv6)ofthe6-monthdatasetarein1-1eq.classes.Although,notamajority,itisstillasubstantialportion,andincreasestoalmost50%whenweconsiderag-gregationtopreﬁxes.AggregationtoPreﬁxes.Frequently,multipleaddressesofanon-1-1equivalenceclassresideinagivennetworkpreﬁx.Therefore,foreachequivalenceclass,weexamineaggregatingaddressesbypre-96Figure5:ScatterplotofnumberofIPv4andIPv6addressesintheequivalenceclasses.Onlythe1-1,1-2,2-1,and2-2eq.classescomprisemorethan1%ofthetotalpopulation,howeverthereareasmallnumberoflargeeq.classesofvariedsizes.ﬁx,therebyformingnetwork-speciﬁceq.classes.Thereisatrade-oﬀregardingthechosensizeofthepreﬁx,wherelargerpreﬁxesleadtomore1-1eq.classes,butalsoincreasethechanceofpoolingtogetherunrelatedequipment.Forex-ample,aggregatingtopreﬁxesasadvertisedbyBGPwouldproduceeq.classeswithanaturalassociationtothenet-works.However,theNetworkOperatorthatadvertisesagivenpreﬁxisnotclaimingthattheaddressesthereinarelocatedinagivenPointofPresence,andareunlikelytobesoforlargerpreﬁxes.Here,weconcernourselveswith1-1eq.classeswhosead-dressesarelikelycandidatestobecollocated.Therefore,weconsidersmallerpreﬁxestoincreasethechanceofcolloca-tion.ForIPv6,anaturalchoiceistoaggregateacrosstheinterfaceIDinthelower64bits.EstablishedpracticeisforIPv6addressesinagiven/64tobeonacommonsubnet,ormayevenbeassociatedwithasingleinterfacewheretheinterfaceIDisvariedforanonymity,[24].ForIPv4thereisnonaturalchoiceforaggregation.Commonly,notalways,operatorsassigntoserversinagivenrack(orsubnet,orbuilding)addressesthatareclosetooneanotherinaddressspace.Areasonableassumption(butforwhichtherewouldbeexceptions)isthataddressesofserversinthesame/30wouldbeinthesamebuilding.Assuminga/29isasome-whatmoreaggressive,andsoon.Fortuitously,giventhearbitrarinessinchoiceofpreﬁx,weﬁndthatforthe1-1eq.classesthereisaninsensitivity,atleastupto/24’sand/48’s.Asanexampleofaggregation,thefollowingﬁvepairs:(122.1.94.240,2001:380:150::1053)(122.1.94.240,2001:380:11c::1053)(122.1.94.240,2001:380:11c::2053)(122.1.94.242,2001:380:11c::1053)(122.1.94.243,2001:380:11c::2053)Table2:Prevalenceof1-1equivalenceclassesinthe6-monthdatasetDataSetEntity%ofIPv4+IPv6addressesin1-1eqclass6-monthdatasetaddresses34%6-monthdatasetpreﬁxes-,/6447.6%6-monthdatasetpreﬁxes/30,/6447.9%6-monthdatasetpreﬁxes/27,/6448.2%6-monthdatasetpreﬁxes/24,/6448.6%6-monthdatasetpreﬁxes/24,/4849.7%6-monthdatasetpreﬁxes/16,/3262.4%6-monthdatasetAS’s80%Restricttoﬁnalweekaddresses71%Randomsubset;samenumofpairsasinlastweekaddresses51%±0.5%ExampleinFig2addresses33%forma3-3eq.classofaddresses.Whenaggregatedtopre-ﬁxes/30,and/64theybecome:(122.1.94.240/30,2001:380:150::/64)(122.1.94.240/30,2001:380:11c::/64)a1-2eq.classofpreﬁxes/30,/64.Foramoredramaticexample,pairedwith88.191.68.83are101IPv6addresses.AlloftheIPv6addressesareinthesinglepreﬁx2a01:e0b:1:68/64.The6-monthdatasetincludestimestampsofwhenagivenpairisﬁrstandlastseen,andtheseIPv6’swerealmostalwaysobservedindis-joint24-hourperiods.Thisislikelyanexamplewherethereisasingleinterfaceandtheinterfaceidentiﬁcation(the64lowestorderbits)varies.Thus,whereastheaddressesforma1-101equivalenceclass,afteraggregatingtheIPv6’sto/64preﬁxes,weobtain1-1eq.classofpreﬁxes.ThesecondthroughseventhrowsofTable2reporttheaggregationtopreﬁxesfordiﬀerentmasks,wheretheequiv-alenceclassesarenowofpreﬁxes.WhenaggregatingjusttheIPv6’sandto/64’s,thesecondrow,thepercentofad-dressesthatareinthe1-1eq.classjumpsfrom34%to47.6%.WhenwealsoaggregatetheIPv4’stopreﬁxes,thereisonlyaminorincreaseinthepercentageevenforaggrega-tionto/24and/48respectively,whichisratheraggressivefromtheviewpointofaddressesthatarelikelytobeonthesamesubnetorlocation.(Aside:thechoiceofpreﬁxhasamorenoticeableimpactforeq.classesgreaterthan1-1;see§4.1.2.)Outofcuriosity,whenwedoanextremeaggregationto/16and/32preﬁxes,wegetthat62%.Insummary,fromtheviewpointofﬁnding(IPv4,IPv6)addresspairsthatarecandidatesforbeingcollocated,weobservethataggregatingtheIPv6’sto/64’syieldsalmost50%oftheaddressestobeinthe1-1equiv.class,andthatthereislittleneedforthesomewhatmoredubiousstepofalsoaggregatingtheIPv4’s.See§5.1forfurthercomments.AggregationtoAS’s.Shiftingthefocusfromaddressesthatarecandidatesforbeingcollocated,andtoconsidertheirdistributionacrossnetworks,weconsideraggregationtoAS’s.WeexcludepairswheretheIPv6addressis6to4,assuchaddresseshaveam-biguousASassignments.With6to4excluded,80%ofthe97addressesareinthe1-1eq.classofAS’s,Table2.However,thisincludesthecircumstancewhenthetwoAS’sarenotequaltoeachother.(Thisissuedoesnotariseforpreﬁxes,astheIPv4isalwaysdistinctfromtheIPv6.)WhenthetwoAS’sarediﬀerent,byfarthemostcommoncaseiswheretheIPv6ASis6939,thetunnelbrokerHurricaneElectric.IfweremovetheaddresspairsofHurricaneElectric,then51%oftheremainingaddressesareinthe1-1ofAS’swhereweim-posetheadditionalconditionthatthetwoAS’sareequaltoeachother.Oftheremaining1-1eq.classesofAS’swherethetwoAS’sarediﬀerent,oftenthetwoAS’sbelongtothesameorganization.Forexample,oftheseASpairswithdis-tinctelements,themostpopularASis7018,ATT.AndoftheAS’sthatarepairedwith7018,82%areAS7132,SBIS-ASATTInternetServices,andanother9%areAS6389,BellSouth.netInc.Asanexampleofdiﬀerentorganizations,whenAS3320,DeutscheTelekom,isina1-1eq.classwithadiﬀerentAS,themostpopularotherASis8422NetCo-longe,whichsuggestbusinessrelationsbesideswhatcanbeinferredfrominterconnection.RestrictiontoaShorterObservationInterval.Asthedatasetisacollectionoverasixmonthperiod,someaddressassignmentsandconﬁgurationslikelychangedduringthisperiod.Thesechangesarereﬂectedaslargereq.classes,asadditionalcomplexity,wheninactuality,theselargeeq.classesmaynothaveeverexistedatagivenmomentintime.Inthissection,weexaminethiseﬀectbyconsideringashorterobservationinterval.However,whenwerestricttoashortertimeinterval,weactuallyintroducetwoeﬀectsthatreducethelargereq.classes,andincreasetheproportionofaddressesinthe1-1eq.class:1)lessopportunityforchangesinaddressas-signments;and2)asmallerdataset.Withasmallerdataset,thereislessopportunityforextantcomplexitytobere-vealed.(Imaginetheextremecaseofjustafewobservations,inwhichcaselargeeq.classesarenotpossible.)Inordertoseparatethesetwoeﬀects,wealsotakeran-domsubsetsofthefulldataset,wherethesubsetshavethesamenumberofpairsaspresentintheshorterobservationinterval.Astherandomsubsetshaveaddresspairsfromthefull,6-monthobservationinterval,theyexhibitjusttheﬁrsteﬀectofasmallerdataset.The6-monthdatasetincludesthetimeepochthegivenpairwaslastobserved.Thus,wecanpickatimeperiod,andthenexaminethesubsetofthepairsthatarelastobservedduringthatperiod.Wepickthelengthtobeaweek,whichisshortenoughthattheopportunityforaddressreassignmentsismuchlessascomparedwith6months,andlongenoughthatwegetanappreciablenumberofpairs,tosomewhatmitigatetheimpactofthesmallerdataset.Also,wepicktheweektobeﬁnalweekofthe6-monthperiod,asthesearethepairsthataremostactive,andtherearetwotoeighttimesasmanypairs,83,000,ascomparedwithanyotherweekonthesixmonths.Table2showstheresultsfortherestrictiontotheﬁnalweek,aswellasfortherandomsubsets,whereforthelat-ter,10subsetsweretakenandthetablereportsthemeanvaluesandtherange.Table2showsthatthefractionofaddressesinthe1-1eq.classesincreasesfrom34%to51%whenwetaketherandomsubsets,whichistheeﬀectofasmallerdataset.Andthepercentageincreasesfurtherto 0 10 20 30 40 50 60 703510301003001000300010000percent of addressesnumber of IPv4 + IPv6 addresses/prefixes in eq. classfull data setfull data set, aggregate to prefixes /32, /64full data set, aggregate to prefixes /24, /48random subset from full data setrestrict to final weekrestrict to final week, aggregate to prefixes /32, /64Figure6:PercentofIPv4+IPv6addressesinequiv-alenceclassesofatleastagivensize71%whenwerestricttotheﬁnalweek,wheretheincrementfrom51%istheeﬀectofreducedopportunityforchangesinconﬁguration.4.1.2AllEquivalenceClassesInthisandthenextthreesub-sections,weshiftthefocusfromthe1-1eq.classes,andcandidateaddresspairsthatlikelyareonthesamemachineorsubnet,tothenon-1-1eq.classes.Figure6showsthepercentofaddressesthatareineq.classesofatleastagivensize,where“size”isthesumofIPv4plusIPv6addresses(preﬁxes)intheeq.class.OnecanviewFigure6asthecomplementarydistributionofanaddressbeinginanequivalenceclassofagivensize.Forexample,lookingatthefulldataset,theredline,40%oftheaddressesareinequivalenceclassesofsizeatleast27.While,whenaggregatingIPv6to/64preﬁxes,thegreenline,40%oftheaddressesareinequivalenceclasses(ofpreﬁxes)ofsizeatleast5.Notethatwiththex-axisbeginningat3,onecaninferthepercentofaddressesin1-1eq.classes,e.g.they-interceptof66%meansthat34%oftheaddressesareinaneq.classofsize2,asreportedinTable2.ThecurvesthatarehigherupintheFigureindicatethat,overall,theequivalenceclassesarelargerandmorecomplex–thedistributionhasaheaviertail.Figure6showsthatalthoughtheaggregationofIPv6to/64noticeablyreducesthetailofthedistribution,still20%oftheaddressesareineq.classesofsize90ormore.Asexpected,withgreateraggregation,to/24and/48preﬁxes,thetailofthedistributionisfurtherreduced.Amoresub-stantialreductionoccurswhenwetakearandomsubsetfromthefulldataset,wherethenumberofpairsinthesub-setequalsthenumberofpairsobservedintheﬁnalweek,§4.1.1.4Thisreductionisduetothesmallersamplesizeascomparedtothefulldataset.Thatis,theadditionalobservationsinthefulldatasetrevealssubstantialmorecomplexity.Weusetheactivetechniqueof§2.2,toperformamorecontrolleddatacollection,overashorttimeperiod,andexaminetheadditionalcomplexitydiscoveredwithaddi-tionalprobingin§4.2.Whenwerestrictthedatatotheﬁnal4Theplotsforthediﬀerentrandomsubsetsareverysimilartooneanother.98week,thereisasigniﬁcantreductionascomparedwiththerandomsubset.Althoughtherandomsubsethasthesamenumberofaddresspairs,itcoversaperiodofsixmonths,andthusthereisagreateropportunityforchangesinad-dressassignmentsandconﬁgurations.Lastly,asexpected,thereissomewhatfurtherreductionwhentheIPv6’sareag-gregatedto/64’sfortheeq.classesoftheﬁnal-weekdataset.InallofthecasesofFigure6,thereisalongtail.Thisisduetothetendencyfortheretobeoneeq.classthatismuchlargerthantheothers,asdiscussednext.4.1.3“Mammoth”equivalenceclassHere,weexaminethelargestequivalenceclass.Asmen-tionedin§2.1.2,oneoftheequivalenceclassesishuge,8037IPv4addressesand9582IPv6’s,8037-9582,whichwecallthe“mammoth”eq.class–itcontains3%oftheaddressesand37%oftheaddresspairs.(Thenextlargesteq.classcontains0.3%oftheaddressesand0.2%ofthepairs.)Thishugeeq.class,whoseaddressesspanmultiplecontinentsandareinover750AS’s,isofinterestfromtheviewpointofhowDNSisbeingusedandarchitected,andhowsuchadiversesetaddressescouldbeassociatedwithoneanother(andclearlydoesnotrepresentasetofloadbalancedname-serversatasinglelocation).Themuchlargerpercentofpairs,37%,ascomparedwithpercentofaddresses,3%,occursbecauseaminorityoftheaddressesareinmanypairs.Intermsofthebipartitegraph,someoftheverticeshavemanyedges.Figure7showsthecomplementarydegreedistributionoftheverticesinthemammotheq.class.Thatis,thepercentofaddresses(vertices)inthemammotheq.classthatareinatleastagivennumberofpairs(edges).Figure7showsthatthedegreedistributionfortheIPv4verticesisroughlythesameasfortheIPv6,thoughwithasomewhatheaviertail.Although54%oftheaddressesareinjustoneaddresspair,i.e.havedegreeone,5asseenfromthey-intercept,8%oftheaddressesareinatleast100pairs,4%inatleast300pairs,and1%inatleast500pairs.Asacomparison,forthefull6-monthdataset89%oftheaddresseshavedegreeone,andonly1%havedegreeatleast15.AS15169,Google,playsamajorroleinthismammotheq.class.6Althoughjust9%oftheaddressesinthemammotheq.classareinAS15169,90%oftheaddresspairshaveoneorbothaddress(es)inthatAS.97%oftheaddressesthatappearinatleast100pairsareinAS15169.WhenevertheIPv6addressisinAS15169,thensoisthepairedIPv4.However,whenevertheIPv4addressisin15169,thepairedIPv6isnotquitealwaysin15169-1%oftheIPv6’sare6to4andanother1%arescatteredacrossahundreddiﬀerentAS’s.ThisishowaddressesoutsideAS15169becomeapartofthiseq.class.Someofthesenon-15169IPv6addressesmaystillbeapartofGoogle’sDNSarchitecture,assumingthatGooglehasdeployedserversinlocalISP’swiththatISP’saddresses.Andalso,somemaybeseparatefromGoogleDNS-iftheclient’snameserver,usingthepublicGoogleDNSforIPv4,obtainedandcachedtheNS5Adegreeonevertexinthebipartitegraphdoesnotimplythatthevertexisinaa1-1eq.class.asthepairedvertexcanhavedegreegreaterthanone.6Otherthird-partyDNSproviders,suchasOpenDNSandDynDNS,arepresentinthedataset,buttoamuchlesserextentcomparedwithGoogleDNS. 0 10 20 30 40 501310301003001000percent of addressesnumber of pairs in which an address appearsIPv4 addressesIPv4 and IPv6 addressesIPv6 addressesFigure7:Percentofaddressesinthe“mammoth”eq.classthatareinatleastagivennumberofpairs.(Complementarydistributionofnodedegreeinbi-partitegraphof“mammoth”eq.class.)Table3:Impactonthelargestequivalenceclassofthe6-monthdatasetwhenselectedaddresspairsareremovedAfteraction,recomputeeq.classes.Resultinglargesteq.classcontains:NumofNumofNumofActionIPv4IPv6addr.addr.addr.pairsnochangetodataset8,0009,600247,000omit6to44,0005,100230,000omitAS151695,6004,90018,000omit6to4andAS151699002,0003,400randomsubsetfromfulldataset;samenum-berofpairsaspriorline2,623±2142,626±33578,778±603recordsreturnedbytheﬁrst-levelauthoritativenameserver;andthenforsubsequentresolutions,sentaDNSqueryoverIPv6tothelow-levelauthoritativenameserver.6to4addressesalsoplayasigniﬁcantroleinthemammotheq.class.Although6to4addressesareinonly6%ofthepairs,theyare42%oftheIPv6addressesinthiseq.class(animbalancethatistheoppositeofAS15169).Interestingly,formanyofthe6to4addresses,theembeddedIPv4addressdoesnotequaltheobservedpairedIPv4.See§4.1.4whichdiscusses6to4inthefulldataset,notjustthemammotheq.class.Itisofinteresttoseewhatbecomesthelargesteq.classwhen,say,AS15169addressesareremoved.Notethatifoneremovesasetofaddressesfromthemammotheq.class,themammotheq.classcanpartitionintomultiplesmallereq.classes-theremainderneednotbeaconnectedsetofedgesinthebipartitegraph.Thus,westartwiththefulldataset,andremovepairsthatcontaintheaddressesinquestion,andthenwiththereducedsetofpairs,werecomputetheequiv.classesandthennotewhichisthelargestone.Table3showstheresultsforselectedremovals.99AsdiscussedinSection4.1.1,someofthereductionissimplyduetoasmallernumberofaddresspairs.Thus,tenrandomsubsetsfromthefull6-monthdatasetaretaken,wherethenumberofpairsinthesubsetisthesameasinthefourthlineoftheTable,225,000pairs,downfrom674,000.Giventhatthecasesofthefourthandﬁfthlinehavethesamenumberofpairs,theirdiﬀerencesareduetheselectiveremovalofparticularpairs,thefourthline,versusrandomremoval.Themeanvalueandrangeisreportedinﬁfthline,andshowsthatthemajorcauseforthelowercomplexityreportedinlinefourisnotduethesmallersample,butrathertheselectedpairsthatareomitted.Evenwiththeomissionof6to4andAS15169,theresult-inglargesteq.classstillhasthousandsofaddresspairs.In§4.3wecontinuetheexaminationoflargesteq.classeswhereweconsiderthe12-daydataset,whichhastheaddi-tionalinformationofthepopularityofanaddresspair,andweshowthatsigniﬁcantfurthersimpliﬁcationisobtainedwhenweomitinfrequentlyobservedpairs.4.1.4Abnormalbehaviorwith6to4Auto-tunneled[9]addressesraiseanaturalquestionwhethertheembeddedIPv4address(i.e.the32bitsthatcomeaf-terthe“2002:”)matchesthepairedIPv4addressfromthediscoverytechnique.Somewhatsurprisingly,in63%ofthepairswheretheIPv6addressis6to4,theembeddedIPv4ad-dressisdiﬀerentfromthepairedaddress.Overall,any6to4traﬃcisprobablyabug:GivenachoicebetweenanIPv4addressanda6to4address,ahostshouldalwayspreferIPv4unlessexecutinga“happyeyeballs”strategy.Sincethere-solveralsoreceivesanIPv4gluerecord,theresolvershouldprefertheIPv4gluerecord,neverattemptingtoconnecttotheDNSauthorityusing6to4.Sometimesthe6to4addressispairedwithhundredsofIPv4’s.Forexample,2002:aca8:101::aca8:101appearswith270IPv4’s.Theembeddedaddressis172.168.1.1,onAOL,andlocatedintheUSA.ThepairedIPv4’saremostlyinBrazil,butalsoGermany,SaudiArabia,andTurkey.Alikelyexplanationissomesortofbuggyresolversoft-warewithahardcoded6to4address.Thatwereceivesuch6to4traﬃcalsosuggeststhatthe6to4gatewayprocessingthistraﬃcisn’tvalidatingthattheembeddedIPv6addresscorrespondstotheIPv4address.Itisnotlikelytobeanat-tackas,ifanattackertookadvantageofthis,thequerytheattackerwouldemploywouldcausesigniﬁcantlymoream-pliﬁcationthanthenamelookupspresentinanAkamai-eddomain.Also,therearestrangercaseswherethe6to4isagainpairedwithmanyIPv4’sbuttheembeddedIPv4isnotroutable.Forexample2002:6464:64cd::6464:64cdispairedwithover250IPv4’sandtheembeddedaddressis100.100.100.205,or2002:10::1:219:dbﬀ:fef9:aa4fwithembeddedaddress0.16.0.0.Again,thissuggestsbuggysoftwaremisusing6to4.Althoughfurtherinvestigationwouldbeneededforadeﬁni-tiveexplanation,itisclearthatthecollectionofnameserverassociationshasturnedouttohavetheadditionalfeatureofrevealingabnormalactivity.Note:incalculatingthepercentofaddressesthatareinone-to-oneassociations,§4.1.1,wekeptallofthecomplexi-tiesinthedataset,includingtheabnormalassociations.Totheextentweremoveany,thepercentageswouldjustgetbetter. 0 5 10 15 20 25 30 35 40351020305070100150200300500percent of addressesnumber of IPv4 + IPv6 addresses in equiv. class200 probes150 probes100 probes50 probes40 probes30 probes20 probes10 probes1 probeFigure8:PercentofIPv4+IPv6addressesinequiv-alenceclassesofatleastagivensize,foropenre-solversprobedatleast200timesonApril19-20,20134.1.5IPv4addresswithinIPv6address(non-6to4)Wementionbrieﬂythatofthefew,92,pairswithTeredoIPv6addresses,(2001:0000::/32)onlyonehasanembed-dedIPv4equaltothepairedIPv4.OfthepairswheretheIPv6addressisneither6to4norTeredo,just0.6%haveanembeddedIPv4equaltothepairedIPv4.Ofthese,57%embedtheIPv4addressinthelowest32bits.Wealsoconﬁrmaninterestinghuman-centricconventioninatleastonemajorISP’sDNSinfrastructurethathasbeenpreviouslyobserved[16].Theoperatorassignsthelower64bitsoftheIPv6address,using16bitstoencodeeachoctetoftheIPv4address,sothatthehexadecimalvaluesrenderasthedecimalequivalentoftheIPv4address,suchas2001:558:1014:f:68:87:76:181.whichispairedwiththeIPv4address68.87.76.181.4.2DiscoveryofComplexityinResolverAs-sociationsUsingActiveDNSMeasurementsHere,wecorroboratethepassivelydiscoveredcomplexityusingtheActiveDNSMeasurementtechniqueof§2.2toper-formacontrolleddatacollectionoverashorttimeperiod.Weﬁrstdeterminetheopenresolversinthe6-monthdataset,forwhichweﬁndabout7,000:5,308IPv4’sand1,677IPv6’s7.Weprobeeachoftheseopenresolversviaouractivetechniqueatleast200timesonApril19-20,2013,request-ingresolutionforourspecialdomainwhichinduceschainsoflookupsacrossIPv6andIPv4glue.Thus,weobtainadatasetoverashortperiodoftime,about13hours,andforwhichthesamesetofnameserversisprobedrepeatedly.Each4-tupleofIPv6/IPv4/IPv6/IPv4yieldseither1,2,or4(IPv4,IPv6)addresspairs,dependingonwhetherthetwoIPv4’sandtwov6’sarethesame.Weareinterestedinthemarginalbeneﬁtofrepeatedac-tiveprobingoftheopenresolvers,fromtheperspectiveofdiscoveringthecomplexityintheIPv4,IPv6nameserverassociationsusingadiﬀerentmethodologythanthepassive7WhilethereexistsamuchlargerpopulationofopenDNSresolversintheInternet,wefocusonlyonthesubsetofopenresolversthatsupportIPv6andappearwithinourpassivelycollectedsix-monthdataset.100technique.Weexaminethoseresolversforwhichthe4-tupleisobtainedatleast200times,andthencomputeequivalenceclassesconditionedondiﬀerentamountsofprobing.Figure8showsthepercentofaddressesthatareinequiv-alenceclassesofatleastagivensize,asafunctionofthenumberofprobes.ThecurvesthatarehigherupintheFig-ureindicatethat,overall,theequivalenceclassesarelargerandmorecomplex–thedistributionhasaheaviertail.Thelowestcurveintheplotisofequivalenceclassesofaddressesfromthose4-tuplesdiscoveredasaresultofjusttheﬁrstprobetoeachoftheresolvers.Thatis,eventhoughatleast200probesweremade,thelowestcurveconsidersjusttheﬁrstone.Thenextcurveabovethatoneisfromthose4-tuplesdiscoveredfromtheﬁrsttenprobes,andsoon.TheFigureshowsthatwithincreasedsampling,additionalname-serveraddressesarediscovered,andtheequivalenceclassesoverallbecomelarger.Notethatthecurvesarestackedontopofeachother,andwherethespacingvaries.Thereisarelativelylargejumpbetweenthecurvefor1probetothatof10probes.Then,asprogressivelytenmoreprobesareincor-porated,upto50probes,thespacingtendstogetsmaller.Andlikewise,thereisarelativelylargejumpbetweenthecurvefor1probetothatof50probes,ascomparedwiththeincrementalspacingfrom50to100,whichinturnislargerthanfrom100to150probes,andwhichisaboutthesamefrom150to200probes.Thus,withtheadditionalprobing,additionalexistingcomplexityisdiscovered,thoughoftenthemarginalincreaseisdecreasing.Moreover(andparticu-larlygiventheimpactofgoingfrom150to200probesbeingaboutthesameasfrom100to150),evenafter200probes,inalllikelihoodwehavenotdiscoveredalloftheexistingcomplexityassociatedwiththisgivensetresolvers.Aswiththesix-monthdataset,thelargesteq.classeshaveaddressesthatspanmultiplecontinentsandmanyAS’s.WeobtainanalogousresultstoFigure8whenineacheq.class,weaggregatetheIPv6’sto/64preﬁxes.Insummary,theactiveDNSmeasurementtechniquealsoﬁndscomplexassociations,evenwhentheprobingisdoneoverashortperiodoftime.Repeatedprobingrevealsadditionalcom-plexity,thoughthemarginalincreasewilldecrease.4.3WorthwhiletoRecordtheFrequencyAd-dressPairsareObservedAkamai’sinitialcodethataggregatedthelogsofthePas-siveDNSMeasurementtechniquedidnotcomputeamea-sureofthefrequencythatanaddresspairwasobserved.Jointlywiththepresentstudy,Akamaiisrevisingthecodetoincludethismeasure.Inthepresentsectionwepresentoneapplicationofthismeasure:detectingtheadditionalcomplexityinnameserverassociationsduetoaddresspairsthatarelessfrequentlyobserved.The12-daydatasetisaone-timecollectionfromAkamai’sproductiondeployment,andincontrasttothe6-monthdataset,includesthenumberoftimesanaddresspairwasob-servedduringthisperiod.Thisdatasetisaprecursortotheproductiondeployment.Thecountsrangefrom1toover17million,withamedianvalueof12.ThepairswithhighestcountsbelongtoComcastandATT.Weareinterestedintheimpactofrestrictingthesetofaddresspairstothosethatwereobservedatleast12timesinthe12days,aswellasfurtherrestrictions.Westartwiththefulldataset,andremovepairsthatcontaintheaddressesTable4:The1-1andthelargestequivalenceclassinthe12-daydataset,andsubsetsthereof%ofwithinthelargesteqclIPv4+IPv6Casein1-1NumofNumofNumofeqclsIPv4IPv6pairs12-daydataset66%68362462,000atleast12occur-rences78%44745530,000omitAS15169&6to472%34647764atleast12occur-rences;andomitAS15169&6to482%13434randomsubsetsfromfulldataset;samenumofpairsaspriorline76%±0.7%468±5.7508±12.511,112±75.3inquestion,andthenwiththereducedsetofpairs,were-computetheeq.classes.TheresultsareshowninTable4.TheTableiscomparabletoTable3forthe6-monthdataset,andalsocontainsaspectsofTable2.Asasanitycheck,Table4includesinfoonthe1-1eq.class.Asshownintheﬁrstrow,66%oftheaddressesareinthe1-1eq.class.Thisisinbetweenthe34%forthe6-monthdataset,andthe71%whenthatdatasetisrestrictedtotheﬁnalweek,wherethelatterismorecomparableindurationtopresentcaseof12days.Thelargesteq.classcontains52%oftheaddresspairs,whichisevenagreatersharethanthe37%ofthe“mam-moth”eq.classofthe6-monthdataset(§4.1.3).WhenweomitthepairswhoseaddressesareinAS15169andwhoseIPv6is6to4,thethirdrow,thenumberofpairsinthelargesteq.classesisjust764,whichisabout1%ofwhatitisforthefull12-daydataset,theﬁrstrow.Thisisthesamepercent-agereductionasoccurredwiththe6-monthdataset,Table3.Now,wheninadditionweomitpairswithfewerthat12occurrences,thenumberofpairsinthelargesteq.classisjust34,afurther20foldreduction.Todistinguishfromreductionduesimplytoasmallernumberofpairs,wetaketenrandomsubsetsofthefull12-daydataset,whereherethesubsetshavethesamenumberofpairsasthefourthrowoftheTable4,21,000pairs.Theﬁfthrowreportsthemeanvalueandrange.Thenumberofpairsinthelargesteq.classisbackupat11,000,thusshowingthatthemajorcausefortherelativelylowcom-plexityreportedinlinefourisnotduethesmallersample,butrathertheselectedpairsthatwereomitted.4.4ValidationToassesstheIPv4toIPv6associationsinferredviathepassiveDNStechnique,weexaminetwosourcesofexternalinformationabouttheresolvers:PTRrecordsandsoftwareversion.Also,wewereabletogetfeedbackfromthreeISP’sregardingsampledata.4.4.1PTRRecordsDNSPTRrecordsmapanIPv4orIPv6addresstoahumanreadablename.WeperformaDNSPTRqueryforeveryaddressinthe6-monthdataset.For14.5%ofthepairs,bothaddresseshaveaPTRrecord.Forthese97,821pairs,Table5showsthepercentofPTRrecordmatchesforthefulldataset,andthenpartitionedbythoseaddresspairs101Table 5: Agreement between associated IPv4 and
IPv6 equivalence classes and their corresponding
DNS PTR records.
# Pairs
with PTR
97,821
8461
89,360

Second-Level
Match
47,752 (48.8%)
5679 (67.1%)
42,073 (47.1%)

Exact
Match
4821 (4.9%)
3500 (41.4%)
1321 (1.5%)

Set

All
1-to-1
Non 1-to-1

Table 6: Agreement between associated IPv4 and
IPv6 equivalence classes and their corresponding
bind.version.

Num of Pairs with
bind.version
8475
4650
3825

Exact
Match
6951 (82.0%)
4619 (99.3%)
2332 (61.0%)

Set

All
One-to-One
Non One-to-One

that are a 1-1 eq. class, and those in a larger eq. class. Of
the addresses in 1-1 eq. classes, we see that 41% have PTR
records that match exactly, as compared to only 1.5% of
the non 1-1 eq. classes. Identical PTR records is supporting,
though not deﬁnitive, evidence that the two addresses are
either on the same server, or are the public-facing interfaces
to a DNS server cluster.

Next, we examine the agreement between the IPv4 and
IPv6 PTR records for just the second-level domain portion
of the name, e.g. foo.bar.com and faz.bar.com match at
the second-level. Whereas an exact PTR record match might
suggest that the IPv4 and IPv6 address correspond to a
common host, a load-balanced or distributed resolver might
assign diﬀerent hostnames to diﬀerent machines, albeit with
the same second-level domain. Supporting this conjecture is
that while only 1.5% of the non 1-1 eq. class pairs have
exactly matching PTR records, 47.1% have a second-level
PTR match. Whereas the diﬀerence is not as pronounced
with pairs in 1-1 eq. classes, with 41.4% matching exactly
and 67.1% matching at the second-level. While DNS PTR
records are frequently incorrect or misleading, these ﬁnd-
ings increase our conﬁdence that our passive technique is
discovering meaningful structure.

Software Version

4.4.2
We examine the version of software reported by the DNS
resolvers discovered in the eq. classes of the 6-month dataset.
To ascertain the software version, we perform a DNS Chaos-
net class (CHAOS) TXT type query for the object version.bind.
35,921 of the addresses respond. An example response is:

“9.7.0-P2-RedHat-9.7.0-10.P2.el5_8.1”

For a baseline of what is the chance that two unrelated ad-
dresses have the same version.bind, we repeatedly ran-
domly pick a IPv4 and a IPv6 address from this set (ignor-
ing whether or not they are observed as a pair), which yields
a 3% match rate.

For 8,475 of the address pairs, both addresses return a
value for version.bind. As shown in Table 6, the version
matches for 82% of these pairs, a value signiﬁcantly higher
than the 3% random baseline. Moreover, 99.3% of the 1-
1 eq. classes have resolvers that report exactly the same
version.

Together, these PTR and version.bind results help sup-
port the validity of our associations and equivalence classes.
While we can not deﬁnitively ascertain whether the two ad-
dresses of a pair are on the same machine, our in-progress
work [8] considers other means to make a more deﬁnitive
determination.

4.4.3 Feedback from Network Operators
We sent sample address associations to personal contacts
at six major networks and got responses from three. All
three conﬁrmed that the IPv4 and IPv6 addresses of all of

the one-to-one associations that they checked are assigned
to the same physical machine. One respondent, a cable op-
erator, further explained that some of the addresses were of
clients. Therefore, some of the associations we observe cor-
respond to resolvers that are run on machines of customers
of said cable operator.
5. DISCUSSION

This Section discusses additional details and implications
of our methodology and results.
In particular, we discuss
the need to ﬁlter when making collocation inferences, and
potential root causes for the non 1-1 eq. classes we observe.
5.1 Screening for collocated addresses

An interest in this paper is the discovery of IPv4, IPv6
address of resolvers that likely are on the same machine, or,
from the viewpoint of geolocation, exist at a common loca-
tion, e.g. data center. With this aim, we ﬁrst wish to dis-
cover the complexity that exists in the Internet of IPv4, IPv6
resolver associations, so as to avoid the false conclusion of
a simple association when reality is more complicated. Our
ﬁndings demonstrate that, given the complexity of address
associations, the observed pairs must be ﬁltered in order to
be most valuable to higher-level objectives, e.g. geolocation.
Natural candidates of value are address pairs that are in
the 1-1 eq. class and have remained so over a period of
time, such as six-months, or remained so after repeated,
active probing, or repeated, passive observations. However,
eq. classes larger than 1-1 also provide value, for instance
eq. classes where the IPv6’s diﬀer only in the lower 64 bits,
given the common practice that such addresses reside on a
common subnet, or may be associated with a single interface
where the interface ID is varied for anonymity.

Excluding non-native IPv6 addresses is natural as these
only associate the IPv4 address with the infrastructure of
a particular transition strategy. If we exclude address pairs
whose IPv6 is 6to4, and then compute eq. classes, and ag-
gregate IPv6’s in the eq. classes to /64 preﬁxes, then for the
six-month data set, we ﬁnd that 50% of the addresses are
associated with the 1-1 eq. classes of preﬁxes, which again
is an appreciable proportion.

Having discovered address pairs that may be on the same
server, we would like a technique that could make a deﬁni-
tive determination. In on-going work, we are developing an
active, ﬁngerprinting technique with that goal – see [8] for
an initial description.
5.2 Large Equivalence Classes

There are several potential causes of equivalence classes

larger than 1-1 ; for DNS resolvers speciﬁcally:

• DNS queries that subvert our multi-level hierarchy, e.g.
manual or automated probes from diﬀerent locations
directed to speciﬁc nameservers.

102In contrast to such simple associations, we also ﬁnd com-
plex, connected sets of address pairs that, at the extreme,
span continents and hundreds of ASes, where third-party
resolvers with distributed shared caches [15] play a major
role. We also observe multiple instances of abnormal use of
6to4 tunnels, where a 6to4 address is paired with hundreds
of diﬀerent IPv4’s that again span multiple continents, and
where the IPv4 embedded in the 6to4 does not equal any of
the paired IPv4’s.

The active technique, which was designed, implemented,
and deployed completely separately from the passive one,
also discovers signiﬁcant complexity on the address-pair as-
sociations. It did so in the context of a controlled experiment
of repeated probing of a given set of open resolvers over a
short period of time, 13 hours.

The passive technique has been implemented in Akamai
Technologies’ DNS infrastructure, where the collected pairs,
after appropriate ﬁltering, are being used to bootstrap ge-
olocation of IPv6 addresses, and were helpful for revisions
to request-routing software to handle IPv6.

Acknowledgments
Matthew Levine had the original idea for the opportunistic
nameserver technique, while Steve Hill, James Kretchmar,
and Brian Sniﬀen contributed to its design and implemen-
tation at Akamai Technologies. Patrick Gilmore provided
insights into common practice of network operators, and via
his contacts obtained feedback on sample address pairs. Our
shepherd, John Heidemann, helped to review and properly
frame the work. Thanks to the anonymous reviewers, Mark
Allman, Billy Brinkmeyer, Aaron Hughes, and Geoﬀrey Xie
for invaluable feedback on initial drafts of this work. This
work supported in part by NSF grants CNS-1111445, CNS-
1111672, and CNS-1213157. This material represents the
position of the authors and not necessarily that of the NSF,
Akamai Technologies, or the U.S. Government.

• Shared distributed caches, such as those commonly
employed by large public DNS resolvers [15].
If NS
records returned from the ﬁrst-level are saved in a
shared cache (with TTL of 12 hours for the present
data set) and subsequently used by another resolver
that sends a query over IPv6, then the second-level
will discover multiple IPv6’s associated with a single
IPv4. A short TTL on the ﬁnal A or AAAA record (20
seconds in the data set) increases reuse of the cached
NS record. Furthermore, after the NS TTL expires and
some other resolver using the shared cache does the
lookup at the ﬁrst-level, then another IPv4 address
could be added to the equivalence class.

However, our results oﬀer a more general caution in eﬀorts
that attempt to pair IPv4 and IPv6 addresses. Complicat-
ing factors that contribute to the complexity observed in
our data, but are not speciﬁc to DNS and may aﬀect other
measurement eﬀorts, include:

• Hosts and interfaces with multiple IPv4 and/or IPv6

addresses.

• Network Address Translation (NAT) [29] of either IPv4
or IPv6, where we observe multiple addresses of the
non-translated protocol that correspond to a smaller
set of addresses from the other. Such translation may
occur at the edge, or within the carrier [20].

• Other forms of middleboxes, including load balancers,

e.g. [3].

• Auto-tunneling, including 6to4, Teredo, etc [9].
• Address changes over time, including ephemeral ad-

dresses [31] and IPv6 privacy extensions [24].

6. CONCLUSIONS

This paper seeks to characterize the inter-relation of IPv4
and IPv6 among Internet DNS resolvers. We deploy both
active and passive measurement techniques to discover and
analyze sets of associated pairs of IPv4, IPv6 addresses.

While prior work has examined IPv4, IPv6 associations for
clients, to our knowledge this paper is the ﬁrst to begin to
examine such associations for equipment within operators’
networks, which can be a leading indicator of IPv6 adoption
[12, 1].

We develop and deploy two novel measurement systems: i)
a passive, opportunistic technique using a two-level DNS hi-
erarchy that encodes IPv4 addresses within IPv6 nameserver
records; and ii) an active DNS probing system that induces
a combination of IPv4 and IPv6 DNS resolver lookups in a
single resolution operation.

For a six-month passive data collection, we ﬁnd that 34%
of the addresses have a one-to-one association, i.e. appear
in no other address pair. This percentage increases to al-
most 50% when the IPv6’s are aggregated to /64’s. We
consider this a positive result for ﬁnding candidate address
pairs that likely are on the same server or subnet, and are
collocated. Supporting evidence is provided via matching
PTR records and software versions, and conﬁrmation from
three major Network Operators of sample pairings. Com-
panion, in-progress work seeks to develop a ﬁngerprinting
technique that would conﬁrm whether an address pair is on
the same server, [8].

1037. REFERENCES
[1] IPv6 Implementors Conference, 2010. https://sites.

google.com/site/ipv6implementors/2010/agenda.

[2] Public DNS: Performance Beneﬁts, 2013.
https://developers.google.com/speed/
public-dns/docs/performance.

[3] J. Abley. A software approach to distributing requests

for DNS service, 2004. http:
//ftp.isc.org/isc/pubs/tn/isc-tn-2004-1.html.

[4] B. Ager, W. M¨uhlbauer, G. Smaragdakis, and

S. Uhlig. Comparing DNS resolvers in the wild. In
Proceedings of the 10th ACM IMC, pages 15–21, 2010.

[5] Akamai. Edgescape geolocation, 2012.

http://www.akamai.com/html/technology/
products/edgescape.html.

[6] R. Arends, R. Austein, M. Larson, D. Massey, and

S. Rose. DNS Security Introduction and
Requirements. RFC 4033, Mar. 2005.

[7] R. Beverly, A. Berger, Y. Hyun, and k. claﬀy.

Understanding the eﬃcacy of deployed internet source
address validation ﬁltering. In Proceedings of the 9th
ACM IMC, pages 356–369, 2009.

[8] R. Beverly, A. Berger, N. Weaver, and L. Campbell.

Inferring Internet Server IPv4 and IPv6 Address
Relationships. Technical Report NPS-CS-13-002,
Naval Postgraduate School, 2013. http:
//calhoun.nps.edu/public/handle/10945/34089.

[9] B. Carpenter and K. Moore. Connection of IPv6
Domains via IPv4 Clouds. RFC 3056, Feb. 2001.

[10] k. claﬀy. Tracking IPv6 evolution: data we have and
data we need. SIGCOMM Comput. Commun. Rev.,
41(3):43–48, July 2011.

[11] L. Colitti, S. H. Gunderson, E. Kline, and T. Reﬁce.

Evaluating IPv6 adoption in the internet. In
Proceedings of the 11th international conference on
Passive and active measurement, PAM’10, pages
141–150, 2010.

[12] Comcast. IPv6 Information Center, 2012.

http://www.comcast6.net/.

[13] S. Deering and R. Hinden. Internet Protocol, Version

6 (IPv6) Speciﬁcation. RFC 2460, Dec. 1998.

[14] R. Elz and R. Bush. Clariﬁcations to the DNS

Speciﬁcation. RFC 2181, July 1997.

[15] Google. Public DNS, 2012. https:

//developers.google.com/speed/public-dns/.

[16] M. Heuse. Recent advances in IPv6 insecurities. In

Chaos Communications Congress, 2010.

[17] G. Huston. IPv6 BGP Statistics, 2013.
http://bgp.potaroo.net/v6/as2.0/.

[18] ISOC. World IPv6 Day, 2011.

http://www.internetsociety.org/ipv6/
archive-2011-world-ipv6-day.
[19] ISOC. World IPv6 Launch, 2012.

http://www.worldipv6launch.org.

[20] S. Jiang, D. Guo, and B. Carpenter. An Incremental
Carrier-Grade NAT (CGN) for IPv6 Transition. RFC
6264 (Informational), June 2011.

[21] Z. M. Mao, C. D. Cranor, F. Douglis, M. Rabinovich,

O. Spatscheck, and J. Wang. A Precise and Eﬃcient
Evaluation of the Proximity Between Web Clients and
Their Local DNS Servers. In Proceedings of the
General Track of the annual conference on USENIX
Annual Technical Conference, ATEC ’02, pages
229–242, 2002.

[22] P. Mockapetris. Domain names - implementation and

speciﬁcation. RFC 1035 (Standard), Nov. 1987.

[23] R. Mohan. Will U.S. Government Directives Spur IPv6

Adoption?, Sept. 2010. http://www.circleid.com/.

[24] T. Narten, R. Draves, and S. Krishnan. Privacy

Extensions for Stateless Address Autoconﬁguration in
IPv6. RFC 4941 (Draft Standard), Sept. 2007.

[25] Nominum. Intelligent DNS, 2012.

http://www.nominum.com/.

[26] E. Nygren, R. K. Sitaraman, and J. Sun. The Akamai

network: a platform for high-performance internet
applications. SIGOPS Oper. Syst. Rev., 44(3):2–19,
Aug. 2010.

[27] RIPE NCC. World IPv6 Day Measurements, 2011.

http://v6day.ripe.net.

[28] N. Sarrar, G. Maier, B. Ager, R. Sommer, and

S. Uhlig. Investigating IPv6 traﬃc: what happened at
the world IPv6 day? In Proceedings of PAM, 2012.

[29] P. Srisuresh and K. Egevang. Traditional IP Network

Address Translator (Traditional NAT). RFC 3022
(Informational), Jan. 2001.

[30] P. Vixie. Extension Mechanisms for DNS (EDNS0).

RFC 2671 (Proposed Standard), Aug. 1999.

[31] Y. Xie, F. Yu, K. Achan, E. Gillum, M. Goldszmidt,
and T. Wobber. How dynamic are IP addresses? In
Proceedings of SIGCOMM, pages 301–312, 2007.

[32] S. Zander, L. L. H. Andrew, G. Armitage, G. Huston,

and G. Michaelson. Mitigating Sampling Error with
Measuring Internet Client IPv6 Capabilities. In
Proceedings of the SIGCOMM IMC, 2012.

104